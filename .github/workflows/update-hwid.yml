name: ğŸ”‘ Auto-Update HWID

on:
  repository_dispatch:
    types: [update-hwid]

permissions:
  contents: write

jobs:
  update-hwid:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: ğŸ” Find and update HWID
        run: |
          KEY="${{ github.event.client_payload.key }}"
          HWID="${{ github.event.client_payload.hwid }}"
          PLAYER="${{ github.event.client_payload.user }}"
          
          echo "ğŸ”„ Updating HWID for key: $KEY"
          echo "ğŸ“± HWID: $HWID"
          echo "ğŸ‘¤ Player: $PLAYER"
          
          # Update the key file
          if grep -q "^$KEY:" aber100pro; then
            echo "âœ… Key found, updating HWID..."
            sed -i "s/^$KEY:.*$/$KEY:$HWID:/" aber100pro
          else
            echo "âš ï¸ Key not found, adding new key..."
            echo "$KEY:$HWID:" >> aber100pro
          fi
          
          echo "ğŸ“ Updated file content:"
          cat aber100pro

      - name: ğŸ’¾ Commit and push changes
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add .
          git diff --staged --quiet || git commit -m "ğŸ”‘ Auto-update HWID for ${{ github.event.client_payload.user }}"
          git push
